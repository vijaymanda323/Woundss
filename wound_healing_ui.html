<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wound Healing Progress Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .analysis-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #2980b9;
            background: #e3f2fd;
        }

        .upload-area.dragover {
            border-color: #27ae60;
            background: #e8f5e8;
        }

        .upload-icon {
            font-size: 3rem;
            color: #3498db;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        .patient-info {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .analyze-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .analyze-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-result {
            margin-top: 20px;
        }

        .result-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #3498db;
        }

        .result-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .result-title i {
            margin-right: 10px;
            color: #3498db;
        }

        .result-value {
            font-size: 1.1rem;
            color: #27ae60;
            font-weight: 600;
        }

        .wound-type {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
        }

        .healing-time {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
        }

        .precautions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .precautions h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .precautions ul {
            color: #856404;
            padding-left: 20px;
        }

        .precautions li {
            margin-bottom: 5px;
        }

        .treatment-recommendations {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .treatment-recommendations h4 {
            color: #0c5460;
            margin-bottom: 10px;
        }

        .treatment-recommendations ul {
            color: #0c5460;
            padding-left: 20px;
        }

        .treatment-recommendations li {
            margin-bottom: 5px;
        }

        .progress-tracking {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .progress-tracking h4 {
            color: #155724;
            margin-bottom: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            transition: width 0.3s ease;
        }

        .reports-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .report-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .report-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .patient-report-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .clinician-report-btn {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
        }

        .report-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px solid #c3e6cb;
        }

        .image-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .report-buttons {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        const WoundHealingApp = () => {
            const [patientInfo, setPatientInfo] = useState({
                id: '',
                name: '',
                age: '',
                gender: '',
                injuryDate: ''
            });
            const [selectedFile, setSelectedFile] = useState(null);
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [analysisResult, setAnalysisResult] = useState(null);
            const [error, setError] = useState(null);
            const [success, setSuccess] = useState(null);
            const fileInputRef = useRef(null);

            const handleFileSelect = (file) => {
                if (file && file.type.startsWith('image/')) {
                    setSelectedFile(file);
                    setError(null);
                } else {
                    setError('Please select a valid image file.');
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                const file = e.dataTransfer.files[0];
                handleFileSelect(file);
            };

            const handleDragOver = (e) => {
                e.preventDefault();
            };

            const handleFileInputChange = (e) => {
                const file = e.target.files[0];
                handleFileSelect(file);
            };

            const analyzeWound = async () => {
                if (!selectedFile) {
                    setError('Please select an image to analyze.');
                    return;
                }

                if (!patientInfo.id || !patientInfo.name) {
                    setError('Please fill in patient ID and name.');
                    return;
                }

                setIsAnalyzing(true);
                setError(null);
                setSuccess(null);

                try {
                    const formData = new FormData();
                    formData.append('image', selectedFile);
                    formData.append('patient_id', patientInfo.id);
                    formData.append('timestamp', new Date().toISOString());

                    const response = await fetch('http://localhost:5000/analyze', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error('Analysis failed. Please try again.');
                    }

                    const result = await response.json();
                    
                    // Enhance the result with additional recommendations
                    const enhancedResult = {
                        ...result,
                        woundType: result.wound_classification?.wound_type || 'Unknown',
                        healingTime: result.wound_classification?.estimated_days_to_cure || 30,
                        precautions: getPrecautions(result.wound_classification?.wound_type || 'unknown'),
                        treatmentRecommendations: getTreatmentRecommendations(result.wound_classification?.wound_type || 'unknown'),
                        progressAdjustments: getProgressAdjustments(result)
                    };

                    setAnalysisResult(enhancedResult);
                    setSuccess('Wound analysis completed successfully!');
                } catch (err) {
                    setError(err.message);
                } finally {
                    setIsAnalyzing(false);
                }
            };

            const getPrecautions = (woundType) => {
                const precautions = {
                    'burn': [
                        'Keep the wound clean and dry',
                        'Avoid exposing to direct sunlight',
                        'Do not pick at scabs or blisters',
                        'Apply prescribed topical medications',
                        'Monitor for signs of infection'
                    ],
                    'cut': [
                        'Keep the wound clean and covered',
                        'Change dressings regularly',
                        'Avoid getting the wound wet',
                        'Watch for signs of infection',
                        'Follow up with healthcare provider'
                    ],
                    'chronic': [
                        'Maintain strict hygiene',
                        'Monitor blood sugar levels (if diabetic)',
                        'Avoid pressure on the wound',
                        'Follow specialized wound care protocol',
                        'Regular medical follow-ups'
                    ],
                    'surgical': [
                        'Keep incision site clean and dry',
                        'Follow post-operative care instructions',
                        'Monitor for signs of infection',
                        'Avoid strenuous activities',
                        'Take prescribed medications'
                    ]
                };
                return precautions[woundType.toLowerCase()] || precautions['cut'];
            };

            const getTreatmentRecommendations = (woundType) => {
                const treatments = {
                    'burn': [
                        'Apply silver sulfadiazine cream',
                        'Use non-adherent dressings',
                        'Consider hydrotherapy for deep burns',
                        'Monitor for compartment syndrome',
                        'Pain management with appropriate analgesics'
                    ],
                    'cut': [
                        'Clean with saline solution',
                        'Apply antibiotic ointment',
                        'Use appropriate dressing type',
                        'Consider sutures for deep cuts',
                        'Tetanus prophylaxis if needed'
                    ],
                    'chronic': [
                        'Debridement of necrotic tissue',
                        'Negative pressure wound therapy',
                        'Hyperbaric oxygen therapy',
                        'Growth factor applications',
                        'Specialized dressings (hydrocolloid, alginate)'
                    ],
                    'surgical': [
                        'Monitor healing progression',
                        'Manage pain appropriately',
                        'Prevent infection with antibiotics',
                        'Physical therapy if needed',
                        'Follow surgical care protocol'
                    ]
                };
                return treatments[woundType.toLowerCase()] || treatments['cut'];
            };

            const getProgressAdjustments = (result) => {
                const adjustments = [];
                
                if (result.healing_pct && result.healing_pct > 0) {
                    adjustments.push(`Healing progress: ${result.healing_pct.toFixed(1)}% improvement`);
                }
                
                if (result.area_cm2) {
                    adjustments.push(`Current wound area: ${result.area_cm2.toFixed(2)} cm²`);
                }
                
                if (result.days_to_heal) {
                    adjustments.push(`Estimated days to complete healing: ${result.days_to_heal}`);
                }
                
                return adjustments;
            };

            const generatePatientReport = () => {
                if (!analysisResult) return;
                
                const report = `
WOUND HEALING REPORT - PATIENT COPY
=====================================

Patient Information:
- Name: ${patientInfo.name}
- ID: ${patientInfo.id}
- Date: ${new Date().toLocaleDateString()}

Wound Analysis:
- Type: ${analysisResult.woundType}
- Estimated Healing Time: ${analysisResult.healingTime} days
- Area: ${analysisResult.area_cm2 ? analysisResult.area_cm2.toFixed(2) + ' cm²' : 'Not calculated'}

Precautions:
${analysisResult.precautions.map(p => `• ${p}`).join('\n')}

Treatment Recommendations:
${analysisResult.treatmentRecommendations.map(t => `• ${t}`).join('\n')}

Progress Tracking:
${analysisResult.progressAdjustments.map(a => `• ${a}`).join('\n')}

Please follow all recommendations and contact your healthcare provider if you have any concerns.
                `;
                
                downloadReport(report, `patient-report-${patientInfo.id}-${new Date().toISOString().split('T')[0]}.txt`);
            };

            const generateClinicianReport = () => {
                if (!analysisResult) return;
                
                const report = `
WOUND HEALING REPORT - CLINICIAN COPY
======================================

Patient Information:
- Name: ${patientInfo.name}
- ID: ${patientInfo.id}
- Age: ${patientInfo.age || 'Not specified'}
- Gender: ${patientInfo.gender || 'Not specified'}
- Injury Date: ${patientInfo.injuryDate || 'Not specified'}
- Analysis Date: ${new Date().toLocaleDateString()}

Technical Analysis:
- Wound Type: ${analysisResult.woundType}
- Estimated Healing Time: ${analysisResult.healingTime} days
- Area: ${analysisResult.area_cm2 ? analysisResult.area_cm2.toFixed(2) + ' cm²' : 'Not calculated'}
- Perimeter: ${analysisResult.perimeter ? analysisResult.perimeter.toFixed(2) + ' pixels' : 'Not calculated'}
- Model Confidence: ${analysisResult.model_confidence ? (analysisResult.model_confidence * 100).toFixed(1) + '%' : 'Not available'}

Clinical Recommendations:
${analysisResult.treatmentRecommendations.map(t => `• ${t}`).join('\n')}

Patient Instructions:
${analysisResult.precautions.map(p => `• ${p}`).join('\n')}

Follow-up:
- Monitor healing progress
- Adjust treatment as needed
- Schedule follow-up appointment in ${Math.ceil(analysisResult.healingTime / 7)} weeks
                `;
                
                downloadReport(report, `clinician-report-${patientInfo.id}-${new Date().toISOString().split('T')[0]}.txt`);
            };

            const downloadReport = (content, filename) => {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            return (
                <div className="app-container">
                    <div className="header">
                        <h1><i className="fas fa-heartbeat"></i> Wound Healing Progress Tracker</h1>
                        <p>Advanced AI-powered wound analysis and healing prediction</p>
                    </div>

                    <div className="main-content">
                        <div className="upload-section">
                            <h2><i className="fas fa-upload"></i> Upload Wound Image</h2>
                            
                            <div 
                                className="upload-area"
                                onDrop={handleDrop}
                                onDragOver={handleDragOver}
                                onClick={() => fileInputRef.current?.click()}
                            >
                                <div className="upload-icon">
                                    <i className="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div className="upload-text">
                                    {selectedFile ? selectedFile.name : 'Click or drag to upload wound image'}
                                </div>
                                <div className="upload-subtext">
                                    Supports JPG, PNG, and other image formats
                                </div>
                            </div>

                            <input
                                ref={fileInputRef}
                                type="file"
                                accept="image/*"
                                onChange={handleFileInputChange}
                                className="file-input"
                            />

                            {selectedFile && (
                                <img 
                                    src={URL.createObjectURL(selectedFile)} 
                                    alt="Preview" 
                                    className="image-preview"
                                />
                            )}

                            <div className="patient-info">
                                <h3><i className="fas fa-user"></i> Patient Information</h3>
                                
                                <div className="form-group">
                                    <label>Patient ID *</label>
                                    <input
                                        type="text"
                                        value={patientInfo.id}
                                        onChange={(e) => setPatientInfo({...patientInfo, id: e.target.value})}
                                        placeholder="Enter patient ID"
                                    />
                                </div>

                                <div className="form-group">
                                    <label>Patient Name *</label>
                                    <input
                                        type="text"
                                        value={patientInfo.name}
                                        onChange={(e) => setPatientInfo({...patientInfo, name: e.target.value})}
                                        placeholder="Enter patient name"
                                    />
                                </div>

                                <div className="form-group">
                                    <label>Age</label>
                                    <input
                                        type="number"
                                        value={patientInfo.age}
                                        onChange={(e) => setPatientInfo({...patientInfo, age: e.target.value})}
                                        placeholder="Enter age"
                                    />
                                </div>

                                <div className="form-group">
                                    <label>Gender</label>
                                    <select
                                        value={patientInfo.gender}
                                        onChange={(e) => setPatientInfo({...patientInfo, gender: e.target.value})}
                                    >
                                        <option value="">Select gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>

                                <div className="form-group">
                                    <label>Injury Date</label>
                                    <input
                                        type="date"
                                        value={patientInfo.injuryDate}
                                        onChange={(e) => setPatientInfo({...patientInfo, injuryDate: e.target.value})}
                                    />
                                </div>
                            </div>

                            <button 
                                className="analyze-btn"
                                onClick={analyzeWound}
                                disabled={isAnalyzing}
                            >
                                {isAnalyzing ? (
                                    <div className="loading">
                                        <div className="spinner"></div>
                                        <span style={{marginLeft: '10px'}}>Analyzing...</span>
                                    </div>
                                ) : (
                                    <><i className="fas fa-search"></i> Analyze Wound</>
                                )}
                            </button>

                            {error && <div className="error-message">{error}</div>}
                            {success && <div className="success-message">{success}</div>}
                        </div>

                        <div className="analysis-section">
                            <h2><i className="fas fa-chart-line"></i> Analysis Results</h2>
                            
                            {analysisResult ? (
                                <div className="analysis-result">
                                    <div className="wound-type">
                                        <h3><i className="fas fa-band-aid"></i> Wound Type</h3>
                                        <div className="result-value">{analysisResult.woundType}</div>
                                    </div>

                                    <div className="healing-time">
                                        <h3><i className="fas fa-clock"></i> Estimated Healing Time</h3>
                                        <div className="result-value">{analysisResult.healingTime} days</div>
                                    </div>

                                    <div className="precautions">
                                        <h4><i className="fas fa-exclamation-triangle"></i> Precautions</h4>
                                        <ul>
                                            {analysisResult.precautions.map((precaution, index) => (
                                                <li key={index}>{precaution}</li>
                                            ))}
                                        </ul>
                                    </div>

                                    <div className="treatment-recommendations">
                                        <h4><i className="fas fa-pills"></i> Treatment Recommendations</h4>
                                        <ul>
                                            {analysisResult.treatmentRecommendations.map((treatment, index) => (
                                                <li key={index}>{treatment}</li>
                                            ))}
                                        </ul>
                                    </div>

                                    <div className="progress-tracking">
                                        <h4><i className="fas fa-chart-bar"></i> Progress Tracking</h4>
                                        {analysisResult.progressAdjustments.map((adjustment, index) => (
                                            <div key={index} style={{marginBottom: '5px'}}>• {adjustment}</div>
                                        ))}
                                    </div>
                                </div>
                            ) : (
                                <div style={{textAlign: 'center', color: '#7f8c8d', padding: '40px'}}>
                                    <i className="fas fa-microscope" style={{fontSize: '3rem', marginBottom: '20px'}}></i>
                                    <p>Upload an image and click "Analyze Wound" to see results</p>
                                </div>
                            )}
                        </div>
                    </div>

                    {analysisResult && (
                        <div className="reports-section">
                            <h2><i className="fas fa-file-medical"></i> Generate Reports</h2>
                            <p>Download detailed reports for patient and clinician use</p>
                            
                            <div className="report-buttons">
                                <button 
                                    className="report-btn patient-report-btn"
                                    onClick={generatePatientReport}
                                >
                                    <i className="fas fa-user"></i> Patient Report
                                </button>
                                <button 
                                    className="report-btn clinician-report-btn"
                                    onClick={generateClinicianReport}
                                >
                                    <i className="fas fa-user-md"></i> Clinician Report
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<WoundHealingApp />, document.getElementById('root'));
    </script>
</body>
</html>




